<!-- Updated chatbot HTML/JS with starter options + logo in every bot message -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Automation Expert's Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* Keep your original CSS as-is â€” only modifications are for starter options + logo */

/* Message rows (modified to support avatar) */
.chat-message-row {
    display: flex;
    margin-bottom: 12px;
    align-items: flex-start;
    gap: 8px;
}
.chat-message-row.user { justify-content: flex-end; }
.chat-message-row.bot  { justify-content: flex-start; }

/* Avatar */
.chat-avatar {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    object-fit: cover;
}

/* Starter Options */
.starter-options {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}
.starter-btn {
    background: #e9f3ff;
    padding: 8px 12px;
    border-radius: 12px;
    font-size: 13px;
    cursor: pointer;
    border: 1px solid #c8d9f0;
    transition: 0.2s ease;
}
.starter-btn:hover {
    background: #d8e9ff;
}

</style>
</head>

<body>

<div id="chatbot-wrapper">

    <button id="hotel-chatbot-launcher">
        <span class="launcher-icon">ðŸ’¬</span>
        <span class="launcher-text">Chat with us</span>
    </button>

    <div id="hotel-chatbot">

        <div id="hotel-chatbot-header">
            <div style="display:flex; align-items:center; gap:12px;">
                <img src="https://cdn.dribbble.com/userupload/12160645/file/original-e65426dddac4245ad2ae68891780100e.png?format=webp&resize=640x480&vertical=center" />
                <div style="display:flex; flex-direction:column;">
                    <span style="font-size:15px;font-weight:600;">Automation Expertâ€™s Assistant</span>
                    <span style="font-size:12px;opacity:0.85;">Here to help</span>
                </div>
            </div>

            <button id="hotel-chatbot-close">Ã—</button>
        </div>

        <div id="hotel-chatbot-messages"></div>

        <div id="hotel-chatbot-input-area">
            <input id="hotel-chatbot-input" placeholder="Ask anything..." />
            <button id="hotel-chatbot-send">Send</button>
        </div>

    </div>
</div>

<script>
let sessionId = localStorage.getItem("hotel_session_id");
if (!sessionId) {
    sessionId = "sess_" + Math.random().toString(36).substring(2);
    localStorage.setItem("hotel_session_id", sessionId);
}

const INITIAL_GREETING = "Hello ðŸ‘‹ I'm your Automation Expert AI assistant.\nHow can I help today?";

const WEBHOOK_URL = "https://n8n.srv1106816.hstgr.cloud/webhook/39c83b8b-cddc-4281-8d13-9c100022c78c";

const launcher = document.getElementById("hotel-chatbot-launcher");
const chat = document.getElementById("hotel-chatbot");
const closeBtn = document.getElementById("hotel-chatbot-close");
const messages = document.getElementById("hotel-chatbot-messages");
const input = document.getElementById("hotel-chatbot-input");
const sendBtn = document.getElementById("hotel-chatbot-send");

const BOT_AVATAR = "https://cdn.dribbble.com/userupload/12160645/file/original-e65426dddac4245ad2ae68891780100e.png?format=webp&resize=640x480&vertical=center";

function appendMessage(text, from = "bot") {
    const row = document.createElement("div");
    row.className = "chat-message-row " + from;

    if (from === "bot") {
        const avatar = document.createElement("img");
        avatar.src = BOT_AVATAR;
        avatar.className = "chat-avatar";
        row.appendChild(avatar);
    }

    const bubble = document.createElement("div");
    bubble.className = "chat-bubble " + from;
    bubble.textContent = text;

    row.appendChild(bubble);
    messages.appendChild(row);
    messages.scrollTop = messages.scrollHeight;
}

function showStarterOptions() {
    const container = document.createElement("div");
    container.className = "starter-options";

    const options = [
        "Learn about our chatbot",
        "See how it works for hotels",
        "Talk to our team",
        "Ask a question"
    ];

    options.forEach(opt => {
        const btn = document.createElement("div");
        btn.className = "starter-btn";
        btn.textContent = opt;

        btn.onclick = () => {
            appendMessage(opt, "user");
            sendToAI(opt);
            container.remove();
        };

        container.appendChild(btn);
    });

    messages.appendChild(container);
}

async function sendToAI(text) {
    try {
        const res = await fetch(WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ chatInput: text, sessionId })
        });

        const data = await res.json();
        appendMessage(data.result || "Sorry, something went wrong.");
    } catch (e) {
        appendMessage("Connection error. Please try again.", "bot");
    }
}

async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    appendMessage(text, "user");
    input.value = "";

    sendToAI(text);
}

launcher.onclick = () => {
    chat.classList.add("open");
    messages.innerHTML = "";

    appendMessage(INITIAL_GREETING, "bot");
    showStarterOptions();
};

closeBtn.onclick = () => chat.classList.remove("open");
sendBtn.onclick = sendMessage;

input.onkeydown = (e) => {
    if (e.key === "Enter") sendMessage();
};

</script>


<!-- Bot avatar constant + starter options + avatar injection added safely -->
<script>
const BOT_AVATAR_URL = "https://cdn.dribbble.com/userupload/12160645/file/original-e65426dddac4245ad2ae68891780100e.png?format=webp&resize=640x480&vertical=center";

// Inject avatar into bot messages
const originalAppendMessage = appendMessage;
appendMessage = function(text, from = "bot") {
    const row = document.createElement("div");
    row.className = "chat-message-row " + from;

    if (from === "bot") {
        const avatar = document.createElement("img");
        avatar.src = BOT_AVATAR_URL;
        avatar.style.width = "32px";
        avatar.style.height = "32px";
        avatar.style.borderRadius = "8px";
        avatar.style.objectFit = "cover";
        row.appendChild(avatar);
    }

    const bubble = document.createElement("div");
    bubble.className = "chat-bubble " + from;
    bubble.textContent = text;
    row.appendChild(bubble);

    messages.appendChild(row);
    messages.scrollTop = messages.scrollHeight;
};

// Starter options on open
function showStarterOptions() {
    const box = document.createElement("div");
    box.style.display = "flex";
    box.style.flexWrap = "wrap";
    box.style.gap = "8px";
    box.style.margin = "10px 0";

    const starters = [
        "Learn about our chatbot",
        "How it works for hotels",
        "Talk to our team",
        "Ask a question"
    ];

    starters.forEach(text => {
        const btn = document.createElement("div");
        btn.textContent = text;
        btn.style.background = "#e9f3ff";
        btn.style.padding = "8px 12px";
        btn.style.borderRadius = "12px";
        btn.style.cursor = "pointer";
        btn.style.fontSize = "13px";
        btn.onclick = () => {
            appendMessage(text, "user");
            sendMessageToAI(text);
            box.remove();
        };
        box.appendChild(btn);
    });

    messages.appendChild(box);
}

// Wrapper for sending quick replies safely
typeof sendMessageToAI === "undefined" && (window.sendMessageToAI = async function(text) {
    const res = await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ chatInput: text, sessionId })
    });
    const data = await res.json();
    appendMessage(data.result || "Sorry, something went wrong.");
});

// Show starters on open
const originalLauncherOnClick = launcher.onclick;
launcher.onclick = () => {
    originalLauncherOnClick();
    showStarterOptions();
};
</script>

</body>
</html>
